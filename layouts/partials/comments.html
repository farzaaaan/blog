{{- if (eq (.Site.Params.disableComments | default false) false) -}}
{{- if (eq (.Params.disableComments | default false) false) -}}
<script>
 function getGiscusTheme() {
        return localStorage.getItem("appearance");
    }

    function setGiscusTheme() {
        function sendMessage(message) {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (!iframe) return;
            iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
        }
        sendMessage({
            setConfig: {
                theme: getGiscusTheme(),
            },
        });
    }

    let giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo": "farzaaaan/blog",
        "data-repo-id": "R_kgDOKjb5bw",
        "data-category": "General",
        "data-category-id": "DIC_kwDOKjb5b84Ccx0O",
        "data-mapping": "pathname",
        "data-strict": "0",
        "data-reactions-enabled": "1",
        "data-emit-metadata": "0",
        "data-input-position": "top",
        "data-theme": getGiscusTheme(),
        "data-lang": "en",
        "data-loading": "lazy",
        "crossorigin": "anonymous",
        "async": ""
    }
    let giscusScript = document.createElement("script");
    Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
    var mainElement = document.querySelector('main');
    mainElement.appendChild(giscusScript);

    window.addEventListener("DOMContentLoaded", (event) => {
        var switchers = document.querySelectorAll("[id^='appearance-switcher']");
        switchers.forEach((switcher) => {
            switcher.addEventListener("click", () => {
                setGiscusTheme( localStorage.getItem("appearance"))

            });

        });
    });
</script>
{{- end -}}
{{- end -}}